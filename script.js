// Enhanced Site Controller with robust i18n and performance optimizations
class SiteController {
  constructor() {
    this.currentLanguage = this.getPreferredLanguage();
    this.currentTheme = this.getPreferredTheme();
    this.translations = {};
    this.init();
  }

  // Language Management
  async loadTranslations() {
    try {
      const [enResponse, ruResponse] = await Promise.all([
        fetch('i18n/en.json'),
        fetch('i18n/ru.json')
      ]);
      
      this.translations.en = await enResponse.json();
      this.translations.ru = await ruResponse.json();
    } catch (error) {
      console.warn('Failed to load translations:', error);
      // Fallback to inline translations if JSON files fail
      this.setupFallbackTranslations();
    }
  }

  setupFallbackTranslations() {
    // Fallback translations in case JSON files are not available
    this.translations = {
      en: {
        "nav.about": "About",
        "nav.experience": "Experience",
        "nav.projects": "Projects", 
        "nav.contact": "Contact",
        "hero.subtitle": "AI Developer & Founder of WizeTale",
        "hero.description": "Building the future of education through AI-powered storytelling. Transforming complex subjects into engaging video experiences.",
        "hero.stats.years": "Years Experience",
        "hero.stats.projects": "Projects Built",
        "hero.stats.awards": "Awards Won",
        "hero.actions.resume": "üìÑ Download Resume (PDF)",
        "hero.actions.contact": "Get in Touch",
        "hero.card.wizetale": "AI-powered educational platform",
        "hero.card.fastapi": "Modern backend development",
        "hero.card.ai": "GPT-4, ElevenLabs, Runway",
        "section.about": "About Me",
        "about.text1": "I'm a passionate student developer and founder building innovative solutions at the intersection of AI and education. My journey started with web development and evolved into creating AI-powered platforms that make learning more engaging and accessible.",
        "about.text2": "Currently leading WizeTale ‚Äî an AI storytelling platform that transforms complex humanities subjects into short, engaging video stories. We're part of the nFactorial Incubator 2025 and have already launched our public demo.",
        "about.highlight.student": "High School Student at Gymnasium No. 1",
        "about.highlight.award": "Runner-Up at nFactorial Incubator Hackathon",
        "about.highlight.focus": "Building AI-powered educational tools",
        "about.skills": "Technical Skills",
        "about.skills.programming": "Programming",
        "about.skills.backend": "Backend & DevOps",
        "about.skills.ai": "AI & Media",
        "about.skills.tools": "Tools & Platforms",
        "section.experience": "Experience & Education",
        "experience.founder.title": "Founder & Lead Developer",
        "experience.founder.description": "Leading development of AI-powered educational platform that converts complex subjects into engaging video stories. Managing full-stack development, AI integration, and product strategy.",
        "experience.backend.title": "Backend Developer",
        "experience.backend.description": "Developed robust backend with JWT authentication, S3 file uploads, Redis caching, Celery tasks, and WebSocket notifications.",
        "experience.student.title": "Student",
        "experience.student.school": "Gymnasium No. 1 named after A. Bokeykhanov",
        "experience.student.description": "High school student with focus on technology and entrepreneurship. Active participant in coding competitions and hackathons.",
        "experience.present": "Present",
        "section.projects": "Featured Projects",
        "project.wizetale.description": "Transforms complex humanities topics into short AI-generated video stories.",
        "project.wizetale.features.ai": "AI Content Generation",
        "project.wizetale.features.video": "Video Production",
        "project.wizetale.features.education": "Educational Focus",
        "project.timecapsule.description": "Robust backend service with authentication, file management, caching, and real-time notifications. Full Docker deployment with CI/CD pipeline.",
        "project.timecapsule.features.auth": "JWT Auth",
        "project.timecapsule.features.files": "File Uploads",
        "project.timecapsule.features.websockets": "WebSockets",
        "section.awards": "Awards & Achievements",
        "award.runnerup": "Runner-Up",
        "award.finalist": "Finalist",
        "award.participant": "Participant",
        "section.contact": "Get In Touch",
        "contact.intro": "I'm always open to discussing new opportunities, collaborations, or just having a chat about technology and AI.",
        "contact.linkedin": "Connect professionally",
        "contact.github": "View my projects",
        "contact.website": "Check out WizeTale",
        "footer.built": "Built with ‚ù§Ô∏è for the web."
      },
      ru: {
        "nav.about": "–û–±–æ –º–Ω–µ",
        "nav.experience": "–û–ø—ã—Ç",
        "nav.projects": "–ü—Ä–æ–µ–∫—Ç—ã",
        "nav.contact": "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
        "hero.subtitle": "AI –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∏ –û—Å–Ω–æ–≤–∞—Ç–µ–ª—å WizeTale",
        "hero.description": "–°–æ–∑–¥–∞—é –±—É–¥—É—â–µ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ AI-–ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ. –ü—Ä–µ–≤—Ä–∞—â–∞—é —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –≤–∏–¥–µ–æ-–æ–ø—ã—Ç—ã.",
        "hero.stats.years": "–õ–µ—Ç –û–ø—ã—Ç–∞",
        "hero.stats.projects": "–ü–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –ü—Ä–æ–µ–∫—Ç–æ–≤",
        "hero.stats.awards": "–ü–æ–ª—É—á–µ–Ω–Ω—ã—Ö –ù–∞–≥—Ä–∞–¥",
        "hero.actions.resume": "üìÑ –°–∫–∞—á–∞—Ç—å –†–µ–∑—é–º–µ (PDF)",
        "hero.actions.contact": "–°–≤—è–∑–∞—Ç—å—Å—è",
        "hero.card.wizetale": "AI-–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞",
        "hero.card.fastapi": "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è backend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞",
        "hero.card.ai": "GPT-4, ElevenLabs, Runway",
        "section.about": "–û–±–æ –º–Ω–µ",
        "about.text1": "–Ø —Å—Ç—Ä–∞—Å—Ç–Ω—ã–π —Å—Ç—É–¥–µ–Ω—Ç-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∏ –æ—Å–Ω–æ–≤–∞—Ç–µ–ª—å, —Å–æ–∑–¥–∞—é—â–∏–π –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ AI –∏ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è. –ú–æ–π –ø—É—Ç—å –Ω–∞—á–∞–ª—Å—è —Å –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª –≤ —Å–æ–∑–¥–∞–Ω–∏–µ AI-–ø–ª–∞—Ç—Ñ–æ—Ä–º, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –æ–±—É—á–µ–Ω–∏–µ –±–æ–ª–µ–µ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º.",
        "about.text2": "–í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è —Ä—É–∫–æ–≤–æ–∂—É WizeTale ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π AI-–ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –∫–æ—Ä–æ—Ç–∫–∏–µ, —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –≤–∏–¥–µ–æ-–∏—Å—Ç–æ—Ä–∏–∏. –ú—ã —è–≤–ª—è–µ–º—Å—è —á–∞—Å—Ç—å—é nFactorial Incubator 2025 –∏ —É–∂–µ –∑–∞–ø—É—Å—Ç–∏–ª–∏ –Ω–∞—à—É –ø—É–±–ª–∏—á–Ω—É—é –¥–µ–º–æ-–≤–µ—Ä—Å–∏—é.",
        "about.highlight.student": "–°—Ç–∞—Ä—à–µ–∫–ª–∞—Å—Å–Ω–∏–∫ –≤ –ì–∏–º–Ω–∞–∑–∏–∏ ‚Ññ1",
        "about.highlight.award": "–í—Ç–æ—Ä–æ–µ –º–µ—Å—Ç–æ –Ω–∞ nFactorial Incubator Hackathon",
        "about.highlight.focus": "–°–æ–∑–¥–∞–Ω–∏–µ AI-–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤",
        "about.skills": "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ù–∞–≤—ã–∫–∏",
        "about.skills.programming": "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ",
        "about.skills.backend": "Backend –∏ DevOps",
        "about.skills.ai": "AI –∏ –ú–µ–¥–∏–∞",
        "about.skills.tools": "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã",
        "section.experience": "–û–ø—ã—Ç –∏ –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",
        "experience.founder.title": "–û—Å–Ω–æ–≤–∞—Ç–µ–ª—å –∏ –í–µ–¥—É—â–∏–π –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫",
        "experience.founder.description": "–†—É–∫–æ–≤–æ–∂—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π AI-–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –≤–∏–¥–µ–æ-–∏—Å—Ç–æ—Ä–∏–∏. –£–ø—Ä–∞–≤–ª—è—é full-stack —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π AI –∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π.",
        "experience.backend.title": "Backend –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫",
        "experience.backend.description": "–†–∞–∑—Ä–∞–±–æ—Ç–∞–ª –Ω–∞–¥–µ–∂–Ω—ã–π backend —Å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π, –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤ –≤ S3, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º Redis, –∑–∞–¥–∞—á–∞–º–∏ Celery –∏ WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏.",
        "experience.student.title": "–°—Ç—É–¥–µ–Ω—Ç",
        "experience.student.school": "–ì–∏–º–Ω–∞–∑–∏—è ‚Ññ1 –∏–º–µ–Ω–∏ –ê. –ë–æ–∫–µ–π—Ö–∞–Ω–æ–≤–∞",
        "experience.student.description": "–°—Ç–∞—Ä—à–µ–∫–ª–∞—Å—Å–Ω–∏–∫ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–æ. –ê–∫—Ç–∏–≤–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é –∏ —Ö–∞–∫–∞—Ç–æ–Ω–æ–≤.",
        "experience.present": "–ù–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è",
        "section.projects": "–ò–∑–±—Ä–∞–Ω–Ω—ã–µ –ü—Ä–æ–µ–∫—Ç—ã",
        "project.wizetale.description": "–ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–µ —Ç–µ–º—ã –≤ –∫–æ—Ä–æ—Ç–∫–∏–µ AI-–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ –≤–∏–¥–µ–æ-–∏—Å—Ç–æ—Ä–∏–∏.",
        "project.wizetale.features.ai": "AI –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ö–æ–Ω—Ç–µ–Ω—Ç–∞",
        "project.wizetale.features.video": "–í–∏–¥–µ–æ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ",
        "project.wizetale.features.education": "–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –§–æ–∫—É—Å",
        "project.timecapsule.description": "–ù–∞–¥–µ–∂–Ω—ã–π backend —Å–µ—Ä–≤–∏—Å —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Ñ–∞–π–ª–∞–º–∏, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–ª–Ω–æ–µ Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å CI/CD –ø–∞–π–ø–ª–∞–π–Ω–æ–º.",
        "project.timecapsule.features.auth": "JWT –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è",
        "project.timecapsule.features.files": "–ó–∞–≥—Ä—É–∑–∫–∞ –§–∞–π–ª–æ–≤",
        "project.timecapsule.features.websockets": "WebSockets",
        "section.awards": "–ù–∞–≥—Ä–∞–¥—ã –∏ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è",
        "award.runnerup": "–í—Ç–æ—Ä–æ–µ –º–µ—Å—Ç–æ",
        "award.finalist": "–§–∏–Ω–∞–ª–∏—Å—Ç",
        "award.participant": "–£—á–∞—Å—Ç–Ω–∏–∫",
        "section.contact": "–°–≤—è–∑–∞—Ç—å—Å—è",
        "contact.intro": "–Ø –≤—Å–µ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π, —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö –∏ AI.",
        "contact.linkedin": "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å",
        "contact.github": "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã",
        "contact.website": "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å WizeTale",
        "footer.built": "–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –≤–µ–±–∞."
      }
    };
  }

  getPreferredLanguage() {
    const savedLang = localStorage.getItem('language');
    if (savedLang && (savedLang === 'en' || savedLang === 'ru')) {
      return savedLang;
    }
    
    const browserLang = navigator.language || navigator.userLanguage;
    return browserLang.startsWith('ru') ? 'ru' : 'en';
  }

  setupLanguageToggle() {
    const languageToggle = document.getElementById('language-toggle');
    if (languageToggle) {
      languageToggle.addEventListener('click', () => {
        this.toggleLanguage();
      });
    }
  }

  toggleLanguage() {
    this.currentLanguage = this.currentLanguage === 'en' ? 'ru' : 'en';
    this.applyLanguage();
    this.updateLanguageToggle();
    this.saveLanguage();
  }

  applyLanguage() {
    // Update HTML lang attribute first
    document.documentElement.lang = this.currentLanguage;
    
    // Apply translations to all elements with data-i18n
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(element => {
      const key = element.getAttribute('data-i18n');
      const translation = this.translations[this.currentLanguage]?.[key];
      if (translation) {
        element.textContent = translation;
      }
    });

    // Handle name translation
    const nameElements = document.querySelectorAll('.hero-title');
    nameElements.forEach(element => {
      const translation = this.translations[this.currentLanguage]?.['name.full'];
      if (translation && this.currentLanguage === 'ru') {
        element.textContent = translation;
      } else {
        element.textContent = 'Dias Junussov';
      }
    });
  }

  updateLanguageToggle() {
    const languageToggle = document.getElementById('language-toggle');
    if (languageToggle) {
      if (this.currentLanguage === 'ru') {
        languageToggle.classList.add('active');
      } else {
        languageToggle.classList.remove('active');
      }
    }
  }

  saveLanguage() {
    localStorage.setItem('language', this.currentLanguage);
  }

  // Theme Management
  getPreferredTheme() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      return savedTheme;
    }
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }

  setupThemeToggle() {
    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
      themeToggle.addEventListener('click', () => this.toggleTheme());
    }
  }

  toggleTheme() {
    this.currentTheme = this.currentTheme === 'light' ? 'dark' : 'light';
    this.applyTheme();
    this.saveTheme();
  }

  applyTheme() {
    const isDark = this.currentTheme === 'dark';
    const isLight = this.currentTheme === 'light';
    
    document.documentElement.classList.toggle('dark', isDark);
    document.documentElement.classList.toggle('light', isLight);
    document.body.classList.toggle('dark', isDark);
    document.body.classList.toggle('light', isLight);
    
    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
      themeToggle.classList.toggle('dark', isDark);
    }
  }

  saveTheme() {
    localStorage.setItem('theme', this.currentTheme);
  }



  // Smooth Scrolling for Navigation Links
  setupSmoothScrolling() {
    const navLinks = document.querySelectorAll('a[href^="#"]');
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href');
        const targetElement = document.querySelector(targetId);
        
        if (targetElement) {
          const offsetTop = targetElement.offsetTop - 80; // Account for fixed navbar
          window.scrollTo({
            top: offsetTop,
            behavior: 'smooth'
          });
        }
      });
    });
  }

  // Navbar Background on Scroll
  setupNavbarScroll() {
    const navbar = document.querySelector('.navbar');
    if (navbar) {
      const handleScroll = () => {
        this.updateNavbarBackground();
      };
      
      window.addEventListener('scroll', this.throttle(handleScroll, 16));
      handleScroll(); // Initial call
    }
  }
  
  updateNavbarBackground() {
    const navbar = document.querySelector('.navbar');
    if (navbar) {
      if (window.scrollY > 50) {
        navbar.classList.add('scrolled');
      } else {
        navbar.classList.remove('scrolled');
      }
    }
  }

  // Intersection Observer for Animations
  setupAnimations() {
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    }, observerOptions);

    // Observe elements for animation
    const animatedElements = document.querySelectorAll('.section, .project-card, .award-card, .contact-card');
    animatedElements.forEach(el => {
      el.style.opacity = '0';
      el.style.transform = 'translateY(20px)';
      el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
      observer.observe(el);
    });
  }

  // Accessibility: Skip to content
  setupSkipLink() {
    const skipLink = document.querySelector('.skip-link');
    if (skipLink) {
      skipLink.addEventListener('click', (e) => {
        e.preventDefault();
        const mainContent = document.getElementById('main-content');
        if (mainContent) {
          mainContent.focus();
          mainContent.scrollIntoView({ behavior: 'smooth' });
        }
      });
    }
  }

  // Email copy functionality
  setupEmailCopy() {
    const emailLink = document.querySelector('a[href^="mailto:"]');
    if (emailLink) {
      emailLink.addEventListener('click', (e) => {
        const email = emailLink.href.replace('mailto:', '');
        navigator.clipboard.writeText(email).then(() => {
          this.showNotification('Email copied to clipboard!', 'success');
        }).catch(() => {
          // Fallback for older browsers
          this.showNotification('Email: ' + email, 'info');
        });
      });
    }
  }

  // Notification system
  showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    
    const icon = document.createElement('span');
    icon.innerHTML = type === 'success' ? '‚úì' : '‚Ñπ';
    icon.style.marginRight = '8px';
    
    const text = document.createElement('span');
    text.textContent = message;
    
    notification.appendChild(icon);
    notification.appendChild(text);
    
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${type === 'success' ? '#10b981' : '#3b82f6'};
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 500;
      z-index: 10000;
      display: flex;
      align-items: center;
      gap: 8px;
      transform: translateX(120%);
      transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    `;
    
    document.body.appendChild(notification);
    
    // Trigger reflow to ensure animation works
    notification.offsetHeight;
    notification.style.transform = 'translateX(0)';
    
    setTimeout(() => {
      notification.style.transform = 'translateX(120%)';
      setTimeout(() => notification.remove(), 300);
    }, 3000);
  }

  // Performance: Throttle function
  throttle(func, limit) {
    let inThrottle;
    return function(...args) {
      if (!inThrottle) {
        func.apply(this, args);
        inThrottle = true;
        setTimeout(() => inThrottle = false, limit);
      }
    }
  }

  // Setup scroll progress indicator
  setupScrollProgress() {
    const progressBar = document.createElement('div');
    progressBar.className = 'scroll-progress';
    document.body.appendChild(progressBar);

    window.addEventListener('scroll', this.throttle(() => {
      const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (winScroll / height) * 100;
      progressBar.style.width = scrolled + '%';
    }, 10));
  }

  // Initialize all functionality
  async init() {
    // Set initial language and theme before loading translations
    document.documentElement.lang = this.currentLanguage;
    this.applyTheme();
    this.updateLanguageToggle();
    
    // Load translations
    await this.loadTranslations();
    
    // Apply language after translations are loaded
    this.applyLanguage();
    
    // Setup all functionality
    this.setupLanguageToggle();
    this.setupThemeToggle();
    this.setupSmoothScrolling();
    this.setupNavbarScroll();
    this.setupAnimations();
    this.setupSkipLink();
    this.setupEmailCopy();
    this.setupScrollProgress();
    
    // Add CSS animations
    this.addAnimationStyles();
  }

  addAnimationStyles() {
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      
      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
      
      .skip-link {
        position: absolute;
        top: -40px;
        left: 6px;
        background: var(--accent);
        color: white;
        padding: 8px;
        text-decoration: none;
        border-radius: 4px;
        z-index: 1001;
        transition: top 0.3s;
      }
      
      .skip-link:focus {
        top: 6px;
      }
    `;
    document.head.appendChild(style);
  }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
  new SiteController();
});



// Typing animation for hero title
function typeWriter(element, text, speed = 100) {
  let i = 0;
  element.innerHTML = '';
  
  function type() {
    if (i < text.length) {
      element.innerHTML += text.charAt(i);
      i++;
      setTimeout(type, speed);
    }
  }
  
  type();
}

// Initialize typing animation when page loads
window.addEventListener('load', () => {
  const heroTitle = document.querySelector('.hero-title .gradient-text');
  if (heroTitle) {
    const originalText = heroTitle.textContent;
    typeWriter(heroTitle, originalText, 150);
  }
});

// Parallax effect for floating cards
window.addEventListener('scroll', () => {
  const cards = document.querySelectorAll('.floating-card');
  const scrolled = window.pageYOffset;
  
  cards.forEach((card, index) => {
    const speed = 0.5 + (index * 0.1);
    const yPos = -(scrolled * speed);
    card.style.transform = `translateY(${yPos}px)`;
  });
});